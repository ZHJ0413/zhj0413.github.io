---
title: 浏览器底层原理
categories: 2
tags: 浏览器
---
> 以chrome为例进行研究和分析

## 1. 宏观视角下的浏览器

```
c/s client --server
b/s browser --server
```

## 2. 进程和线程

- **进程**就是在内存中正在运行的应用程序
  - 在内存中独占一个内存空间
  - 进程和进程之间是相互隔离的
- **线程**就是进程的最小执行单位（CPU调度的最小单位）
  - 一个进程是由多个线程组成的
  - 线程和线程之间也是相互隔离的

1、线程是进程的基本单位，一个进程由一个或者多个线程组成，搞清楚这个关系之后，我们可以明确线程就是程序执行的最小单元

2、线程和进程一样，也是动态概念，有创建有销毁，存在只是暂时的，不是永久性的

3、进程与线程的区别在于进程在运行时拥有独立的内存空间，也就是说每个进程所占用的内存都是独立的

4、多个线程是共享内存空间的，但是每个线程的执行是相互独立的，线程必须依赖于进程才能执行，单独的线程是无法执行的，由进程来控制多个线程的执行，没有进程就不存在线程

## 3. 浏览器中的五个进程

- **浏览器进程。**主要负责界面显示、用户交互、子进程管理、同时提供存储等功能。
- **渲染进程。** 核心任务是将HTML、CSS和JavaScript**转换**为**用户可以与之交互的网页**，排版引擎Blink和JavaScript引擎V8都运行在该进程中，默认情况下，Chrome为每一个Tab标签页创建一个渲染进程。出于安全考虑，渲染进程都是运行在沙箱模式下的。
- **GPU进程。**GPU图形处理器（英语：graphics processing unit，缩写：*GPU*）,负责3D css效果，网页，Chrome ui的绘制。
- **网络进程**。主要负责页面的网络资源加载，之前是作为一个模块运行在浏览器进程里面的，直至最近才独立处理，成为单独一个进程。
- **插件进程**。主要负责插件的运行，因为插件易崩溃，所以通过插件进程来隔离，以保证插件进程崩溃不会对浏览器和页面造成影响

## 4. 计算机网路的七层模型

- **应用层**：HTTP协议

- **表示层**：

- **会话层**：

- **传输层**：UDP（用户数据包协议）/TCP（传输控制协议）

- **网络层**：IP协议

- **数据链路层**：MAC地址，封装byte

- **物理层**：使用一定的物理介质（网线，光纤，wifi）来进行计算机之间的连接

## 5. HTTP的请求流程

> 浏览器发送HTTP请求的过程

- 构造请求行：`GET test/artice HTTP/1.1`
- 查找缓存：有缓存就取缓存，没有缓存就发送网络请求
- 准备IP地址和端口号
- 等待TCP队列：一个域名最多建立6个TCP连接
- 建立TCP连接
- 发送HTTP请求

> 服务器返回HTTP请求

- 返回请求内容
- 断开连接

## 5. 从进程的角度讨论输入URL地址到浏览器显示页面的过程中发生了什么？

> 浏览器主进程，网络进程，渲染进程

- 浏览器主进程中输入URL请求
- 浏览器主进程将URL请求派发给网络进程
- 在网络进程中发送URL请求，获取响应头数据，解析响应头数据后将数据转发给浏览器主进程
- 浏览器主进程接收到网络进程的响应数据之后发送**提交文档**消息到渲染进程
  - 提交文档：在浏览器主进程中，将网络进程接受的HTML数据提交给渲染进程。

- 在渲染进程中接受到消息之后，准备接收HTML数据，接受数据的方式是直接和网络进程之间建立数据管道

- 文档数据传输完毕，渲染进程会返回**确认提交**消息给浏览器主进程
- 在浏览器主进程中受到渲染进程的**确认提交**消息后，开始移除旧的文档，更新浏览器进程的页面状态

